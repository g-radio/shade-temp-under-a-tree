<main class="w-full min-h-screen p-4 sm:p-6 md:p-8 flex items-center justify-center">
  <div class="w-full max-w-4xl mx-auto bg-white/50 dark:bg-gray-800/50 backdrop-blur-xl rounded-2xl shadow-2xl overflow-hidden border border-white/30">
    <div class="grid grid-cols-1 lg:grid-cols-2">

      <!-- Left Side: Inputs -->
      <div class="p-8 border-b lg:border-b-0 lg:border-r border-gray-200/50 dark:border-gray-700/50">
        <div class="flex justify-between items-center mb-6">
          <h1 class="text-2xl font-bold text-gray-800 dark:text-white">Weather Conditions</h1>
          <!-- Unit Toggle -->
          <div class="bg-gray-200 dark:bg-gray-700 p-1 rounded-full flex text-sm font-semibold">
            <button
              (click)="setUnits('imperial')"
              [class]="units() === 'imperial' ? 'bg-white dark:bg-gray-900 text-blue-600 dark:text-blue-400 shadow' : 'text-gray-600 dark:text-gray-300'"
              class="px-3 py-1 rounded-full transition-all duration-300">
              °F
            </button>
            <button
              (click)="setUnits('metric')"
              [class]="units() === 'metric' ? 'bg-white dark:bg-gray-900 text-blue-600 dark:text-blue-400 shadow' : 'text-gray-600 dark:text-gray-300'"
              class="px-3 py-1 rounded-full transition-all duration-300">
              °C
            </button>
          </div>
        </div>
        <p class="text-gray-600 dark:text-gray-400 mb-4 text-sm">
          Enter a location and search, get live weather for your current position, or use the sliders to enter values manually.
        </p>

        <form (submit)="searchLocation(); $event.preventDefault()" class="flex gap-2 mb-4">
          <input 
            type="text" 
            placeholder="e.g., London, UK or 90210"
            [value]="searchQuery()"
            (input)="onSearchQueryInput($event)"
            class="flex-grow px-3 py-2 bg-white/50 dark:bg-gray-700/50 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 transition"
            [disabled]="isLoading()">
          <button 
            type="submit"
            [disabled]="isLoading() || !searchQuery().trim()"
            class="flex items-center justify-center gap-2 px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors duration-300">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z" clip-rule="evenodd" />
              </svg>
          </button>
        </form>

        <div class="relative flex py-2 items-center">
            <div class="flex-grow border-t border-gray-300/80 dark:border-gray-600/80"></div>
            <span class="flex-shrink mx-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Or</span>
            <div class="flex-grow border-t border-gray-300/80 dark:border-gray-600/80"></div>
        </div>

        <button 
          (click)="fetchWeatherForCurrentLocation()"
          [disabled]="isLoading()"
          class="w-full flex items-center justify-center gap-2 mb-6 px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors duration-300">
          @if (isLoading()) {
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Fetching Weather...</span>
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path fill-rule="evenodd" d="m9.69 18.933.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 0 0 .281-.14c.186-.1.4-.27.6-.533a7.741 7.741 0 0 0 .826-1.336c.262-.65.433-1.445.52-2.394.048-.51.066-1.047.066-1.614 0-1.036-.056-2.03-.176-2.964a25.026 25.026 0 0 0-.34-1.637c-.2-.642-.48-1.247-.798-1.78a5.592 5.592 0 0 0-.943-1.223 4.27 4.27 0 0 0-1.16-1.012c-.4-.28-.84-.5-1.32-.642a4.27 4.27 0 0 0-1.282-.244A4.27 4.27 0 0 0 10 2c-.482 0-.964.082-1.402.244a4.27 4.27 0 0 0-1.282.642 4.27 4.27 0 0 0-1.16 1.012 5.592 5.592 0 0 0-.943 1.223C4.8 6.63 4.52 7.234 4.32 7.877c-.116.37-.22.78-.31 1.22-.108.528-.196 1.125-.262 1.762-.06.567-.09 1.173-.09 1.82 0 .566.018 1.104.066 1.613.087.95.258 1.745.52 2.394.246.626.564 1.16.826 1.336.198.187.414.364.6.533.095.056.192.103.28.14l.018.008.006.003Z" clip-rule="evenodd" />
            </svg>
            <span>Use My Current Location</span>
          }
        </button>

        @if (errorMessage(); as msg) {
          <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert">
            <p class="font-bold">Error</p>
            <p>{{ msg }}</p>
          </div>
        }

        <!-- Air Temperature Slider -->
        <div class="mb-6">
          <label for="temperature" class="flex justify-between items-center text-md font-medium text-gray-700 dark:text-gray-300 mb-2">
            <span>Air Temperature</span>
            <span class="text-blue-600 dark:text-blue-400 font-bold text-lg">
              {{ airTemperature() | number:'1.0-1' }}
              @if (units() === 'imperial') {
                <span>°F</span>
              } @else {
                <span>°C</span>
              }
            </span>
          </label>
          @if (units() === 'imperial') {
            <input id="temperature" type="range" min="30" max="120" step="0.1" [value]="airTemperatureF()" (input)="onTempChange($event)" class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600">
          } @else {
            <input id="temperature" type="range" min="0" max="50" step="0.1" [value]="airTemperatureC()" (input)="onTempChange($event)" class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600">
          }
        </div>

        <!-- Humidity Slider -->
        <div class="mb-6">
          <label for="humidity" class="flex justify-between items-center text-md font-medium text-gray-700 dark:text-gray-300 mb-2">
            <span>Relative Humidity</span>
            <span class="text-green-600 dark:text-green-400 font-bold text-lg">{{ humidity() }}%</span>
          </label>
          <input id="humidity" type="range" min="0" max="100" [value]="humidity()" (input)="onHumidityChange($event)" class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-green-600">
        </div>

        <!-- Wind Speed Slider -->
        <div>
          <label for="wind" class="flex justify-between items-center text-md font-medium text-gray-700 dark:text-gray-300 mb-2">
            <span>Wind Speed</span>
            <span class="text-purple-600 dark:text-purple-400 font-bold text-lg">
              @if (units() === 'imperial') {
                <span>{{ windSpeedMph() | number:'1.0-1' }} mph</span>
              } @else {
                <span>{{ windSpeedKph() | number:'1.0-1' }} kph</span>
              }
            </span>
          </label>
          @if (units() === 'imperial') {
            <input id="wind" type="range" min="0" max="40" step="0.1" [value]="windSpeedMph()" (input)="onWindChange($event)" class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600">
          } @else {
            <input id="wind" type="range" min="0" max="65" step="0.1" [value]="windSpeedKph()" (input)="onWindChange($event)" class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600">
          }
        </div>
      </div>

      <!-- Right Side: Output -->
      <div class="p-8 bg-blue-50/50 dark:bg-gray-900/50 flex flex-col justify-center items-center text-center">
        <div class="mb-4">
           <svg class="w-20 h-20 text-green-500 mx-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12.64,4.23c0.45-0.45,0.45-1.18,0-1.63L11.5,1.46c-0.45-0.45-1.18-0.45-1.63,0l-2.8,2.8c-0.45,0.45-0.45,1.18,0,1.63l1.14,1.14c0.45,0.45,1.18,0.45,1.63,0L12.64,4.23z M8.93,10.7c-0.28-0.28-0.72-0.28-1,0l-1.4,1.4c-0.28,0.28-0.28,0.72,0,1l1.4,1.4c0.28,0.28,0.72,0.28,1,0l1.4-1.4c0.28-0.28,0.28-0.72,0-1L8.93,10.7z M18,12.5c0-3.83-2.92-6.96-6.66-7.42C10.05,2.16,7.5,4.05,7.5,6.75c0,1.45,0.67,2.73,1.7,3.61l-2.45,2.45C5.32,12.35,3,14.62,3,17.5c0,2.25,1.4,4.19,3.34,4.86c0.55,0.19,1.11,0.29,1.66,0.29c2.75,0,5-2.25,5-5c0-1.45-0.67-2.73-1.7-3.61l1.62-1.62c0.2-0.2,0.46-0.31,0.74-0.31c0.21,0,0.41,0.06,0.59,0.17c0.39,0.22,0.66,0.61,0.7,1.06C15.02,15.75,18,15.1,18,12.5z M6,19.5c-1.38,0-2.5-1.12-2.5-2.5S4.62,14.5,6,14.5s2.5,1.12,2.5,2.5S7.38,19.5,6,19.5z"/>
          </svg>
        </div>

        <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300">Feels Like in Tree Shade</h2>
        <p class="font-extrabold text-7xl md:text-8xl my-2 text-gray-900 dark:text-white tracking-tighter">
          {{ feelsLikeInShade() | number:'1.0-1' }}°
        </p>
        <div class="bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300 text-sm font-semibold px-4 py-2 rounded-full">
          Feels like {{ feelsLikeInSun() | number:'1.0-1' }}° in direct sun
        </div>
        <div class="mt-8 text-xs text-gray-500 dark:text-gray-400 max-w-xs text-balance">
          <h3 class="font-semibold mb-1 text-gray-600 dark:text-gray-300">How It's Calculated</h3>
          <p>
            This estimate is based on the NOAA Heat Index formula, which combines air temperature and humidity. It's then adjusted for wind's cooling effect. The "direct sun" value adds an approximation for solar radiation.
          </p>
        </div>
      </div>
    </div>
  </div>
</main>